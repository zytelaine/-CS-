## CH4 指令系统

### 4.1概念

指令：指挥机器完成某种操作的命令

指令系统：计算机可以直接识别，执行的所有指令的集合，是计算机软件与硬件的界面

程序：若干条有序指令的集合

按照计算机的系统层次划分，有微指令、机器指令、宏指令

微指令：微程序层级的指令，来产生控制信号，最低层级（指令的执行由微指令解析）

机器指令：在微指令和宏指令直接，每条可以完成一个独立的操作

宏指令：几条机器指令组成的**软件指令**

**本章讨论机器指令**

### 4.2指令格式

指令主要分为两类：**动作类**（传送类、运算类、I/O指令等）、**控制类**（循环指令、移位指令、停机指令等）

一条**指令的机器字**，被称为**指令字**，简称**指令**。

**指令格式：**指令字用二进制代码表示的结构

<img src="C:\Users\Zhao Yitong\AppData\Roaming\Typora\typora-user-images\image-20250622042656484.png" alt="image-20250622042656484" style="zoom: 33%;" />

操作码**OP：**指令执行什么操作。位数取决于计算机的指令系统规模。n位操作码可以执行2^n

**地址码A**

**一条指令必须包含如下信息：1.操作码 2.操作数的地址 3.操作结果的存储地址 4.下一条指令的地址**

#### 1.零地址指令：只有操作码（1）不需要操作数，如停机指令（2）操作数默认，零地址的运算指令只可能存在在堆栈计算机中

#### 2.一地址指令：OP+A（操作数的存储器地址或寄存器名）该地址既是操作数地址又是结果存储地址，或者第一个源操作数由地址码A给出，第二个源操作数在一个默认的寄存器中，运算结果仍送回到这 个寄存器中，替换了原寄存器内容，通常把这个寄存器称为累加器。

#### 3.二地址指令：OP+A1+A2。A1第一个源操作数的存储器地址和寄存器地址。A2第二个和结果的存储器或寄存器地址

#### 4.三地址指令：OP+A1+A2+A3.结果放A3

**按操作数类型定义的指令格式：**

1、访问内存的指令格式。SS型指令（存储器-存储器）

2、访问寄存器的指令格式。RR型指令（寄存器-寄存器）

3、RS型指令（寄存器-存储器）

### 4.3指令格式的选取

**机器字长是指计算机能直接处理的二进制数 据的位数，它决定了计算机的运算精度。**

**指令长度通常是字节(1B)的整数倍（8bit）**

指令格式的选取：

1.长度尽可能短。

2.指令长度和机器长度都应该是字节的整数倍

3.操作码字段应该足够长表示全部的操作

4.地址段位数应该足够长

<img src="C:\Users\Zhao Yitong\AppData\Roaming\Typora\typora-user-images\image-20250622050439585.png" alt="image-20250622050439585" style="zoom:50%;" />

**注意：指令的地址由PC程序计数器规定的，数据地址是由指令规定的！！！CPU不会将指令和数据混淆**

- pc:程序计数器。存放**当前想要**执行的**指令地址**，可以+1形成下一条指令的地址，和**主存储器的MAR相连**

<img src="C:\Users\Zhao Yitong\AppData\Roaming\Typora\typora-user-images\image-20250622051424458.png" alt="image-20250622051424458" style="zoom: 50%;" />

### 4.4寻址方式

**形成有效**的指令地址或操作数地址的方式，称为寻址方式。

指令地址给出的往往是形式地址，而有效地址是通过一定的计算方式得到。

寻址方式分为两大类：**指令寻址**和**操作数寻址**

#### 4.4.1指令寻址：确定下一条要执行的指令的地址

##### 1.顺序寻址方式：指令在内存中按地址顺序安排。专用PC来控制指令顺序执行，计数指令顺序号。

执行 程序时，通常是一条指令接一条指令顺序进行。 即从存储器取出第一条指令，然后执行第一条 指令；接着从存储器取出第二条指令，再执行 第二条指令；接着再取出第三条指令，执行第 三条指令……这种程序按指令地址顺序执行的过 程，称为指令的顺序寻址方式

##### 2.跳跃寻址：下一条指令的地址由本条指令修改PC后给出。程序跳跃后，新的指令地址开始顺序执行

令跳跃寻址式，可以实现程序转移 或构成循环程序，从而能缩短程序长度，或将 某些程序作为公共程序引用，指令系统中的各 种条件转移或无条件转移指令，就是为了实现 指令的跳跃寻址而设置的。

#### 4.4.2操作数寻址：确定数据的地址方法。

1.直接寻址:**地址码给出操作数在存储器中的地址**（b的M是寻址方式字段,可能是为了凑整数位）

<img src="C:\Users\Zhao Yitong\AppData\Roaming\Typora\typora-user-images\image-20250622053201086.png" alt="image-20250622053201086" style="zoom:50%;" />

2.寄存器寻址：算机的中央处理器一般设置有一定数量 的通用寄存器，用以存放操作数、操作数的 地址或中间结果。假如指令地址码部分给出 某一通用寄存器地址，而且所需的操作数就 在这一寄存器中，则称为寄存器寻址。

3.基址寻址：设置一个专用的基址寄存器，或由指令确定一个通用寄存器为基址寄存器。**操作数的地址由基址寄存器的内容和指令的地址码A相加得到**

**目的：扩大寻址范围**、

面向操作系统，内容由操作系统或管理程序确定。程序执行过程中基址寄存器的内容不变（基地址），形式地址A可变（偏移量）。通用寄存器作为基准址寄存器时，用户可觉得用哪一个通用寄存器，但是内容仍然由操作系统决定。

<img src="C:\Users\Zhao Yitong\AppData\Roaming\Typora\typora-user-images\image-20250622053511397.png" alt="image-20250622053511397" style="zoom:50%;" />

4.变址寻址

变址寄存器面向用户，程序执行的过程中，变址寄存器的内容可以由用户改变（偏移量），形式地址A不变（基地址）。可以处理**数组问题**。

<img src="C:\Users\Zhao Yitong\AppData\Roaming\Typora\typora-user-images\image-20250622053545160.png" alt="image-20250622053545160" style="zoom:50%;" />



5.间址寻址

指令的**地址码**取出的不是操作数，而是**操作数的有效地址所在的存储单元的地址。** *地址的地址*

根据**地址码**指的是**寄存器地址**还是**存储器地址**，间接寻址分为寄存器间址寻址和存储器间址寻址

间接寻址有一次间址和多次间 址两种情况，大多数计算机只允许一次间址。对于存 储器一次间址情况，需访问两次存储器才能取得数据， 第一次从存储器读出操作数地址，第二次读出操作数

**好处：扩大寻址范围。**（有效地址的位数会大于形式地址A的位数）

**缺点：**多次访存，一次**存储器**间接寻址要2次防存，速度会慢

<img src="C:\Users\Zhao Yitong\AppData\Roaming\Typora\typora-user-images\image-20250622054239643.png" alt="image-20250622054239643" style="zoom:50%;" />

6.立即数寻址

需的**操作数**由指令的**地址码部分直接给 出**，就称为立即数(或直接数)寻址方式。这种 方式的特点是取指时，**操作码和一个操作数 同时被取出**，**不必再次访问存储器**，提高了 指令的执行速度。通常用于**给某一寄存器或 存储器单元赋初值或提供一个常数**等。

### 4.6指令系统的优化设计

#### 1.扩展编码法

使操作码在冗余尽量小的基础上，使操作码规整一些。

**扩展编码先考虑地址多的指令的设计，后考虑地址次多的指令，最后考虑0地址指令**

**缩短单个地址码长度的方法：**

1.用间接寻址方式

2.用变址寻址方式

3.用寄存器间址寻址方式

**预留扩展码（1111）**

### 4.8 R(reduced精简指令系统计算机)ISC&C(complex复杂指令系统计算机)ISC

CISC: x86

RISC: ARM

<img src="C:\Users\Zhao Yitong\AppData\Roaming\Typora\typora-user-images\image-20250622063724753.png" alt="image-20250622063724753" style="zoom:50%;" />